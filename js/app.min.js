var viewModel={compareLocations:function(a,b){var c=38.103,d=-121.572,e=.1,f=!1;if(e>a-c){var g=a-c;if(e>a+c){var g=e>a+c;g>0&&e>g&&(f=!0)}}var h=!1;if(e>b-d){var g=b-d;if(e>b+d){var i=e>b+d;i>0&&e>i&&(h=!0)}}return f&&1==h?!0:void 0},userLocation:function(a){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){var c={lat:b.coords.latitude,lng:b.coords.longitude};1==viewModel.compareLocations(b.coords.latitude,b.coords.longitude)&&a.setCenter(c)}):console.log("continuing on to delta loop map")},initMap:function(){console.log("this: ",this," ","window: ",window);var a=document.getElementById("map"),b={center:{lat:38.103,lng:-121.572},zoom:12,mapTypeId:google.maps.MapTypeId.HYBRID},c=new google.maps.Map(a,b);viewModel.userLocation(c);for(var d=0;d<mapMarkers.obstructions.length;d++)new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:c,center:mapMarkers.obstructions[d].center,radius:30,draggable:!0});var e=new google.maps.InfoWindow({map:c});this.infowindow=e,e.close(),this.map=c},initFacebook:function(){window.fbAsyncInit=function(){FB.init({appId:"887545611339686",xfbml:!0,version:"v2.4"})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")},markers:[],addMarkers:function(a){var b=a.length,c=new google.maps.LatLngBounds;for(i=0;i<b;i++){var d=a[i].center.lat,e=a[i].center.lng,f=a[i].center;if(a[i].icon)var g=a[i].icon;else var g="/images/mapIcons/marina_brown.png";viewModel.markers.push(new google.maps.Marker({position:f,map:this.map,animation:google.maps.Animation.DROP,id:a[i].name,icon:g})),viewModel.markers[i].addListener("click",viewModel.clickMarker),c.extend(new google.maps.LatLng(d,e))}this.map.fitBounds(c),this.map.panBy(-60,0)},mapPopUp:function(a){this.infowindow.close();for(var b=viewModel.retrieveJsonArray("fb"),c=viewModel.retrieveJsonArray("url"),d=viewModel.retrieveJsonArray("name"),e=viewModel.retrieveJsonArray("img"),f=0;f<d.length;f++)if(a.id==d[f]){var g=b[f],h=c[f],i=e[f];if(void 0!=g)var j='<div id="fb-root"></div><div class="fb-page" data-href="'+g+'" data-small-header="true" data-adapt-container-width="false" data-hide-cover="false" data-show-facepile="false" data-show-posts="false"><div class="fb-xfbml-parse-ignore"><blockquote cite="'+g+'"><a href="'+g+'">click me</a></blockquote></div></div>';else var j='<div><a href= "'+h+'" target="_blank"><h3>'+a.id+'</h3><img class="infoWindowImg" src="'+i+'" alt="scenic image"></div><div></a></div>';this.infowindow.setContent(j),this.infowindow.open(a.map,a)}FB.XFBML.parse()},clickMarker:function(){var a=document.getElementsByClassName("sideBarElems"),b=this;viewModel.resetMarkerColor();for(var c=0;c<viewModel.markers.length;c++){var d=a[c].id;if("highlight"==d)a[c].setAttribute("id","null");else if(a[c].innerHTML==this.id){viewModel.mapPopUp(b),a[c].setAttribute("id","highlight");var e=this.icon;e=e.replace("brown","white"),this.icon=e,this.map.panTo(this.getPosition()),this.setMap(this.map),this.setZIndex(1)}}},clearMarkers:function(){for(var a=0;a<viewModel.markers.length;a++)viewModel.markers[a].setMap(null);viewModel.markers=[]},sideBarArray:ko.observableArray(),searchTerm:ko.observable(),ph:ko.observable("search all locations"),searchButton:function(){viewModel.clearSearch();var a=[],b=new RegExp(viewModel.searchTerm(),"i");$.each(viewModel_onLoad.searchCategories,function(c,d){var e=d;$.each(mapMarkers[e],function(c,d){var f=mapMarkers[e][c].name,g=f.toString(),h=mapMarkers[e][c],i=b.test(g);0==i&&(f="notSearchedFor");for(var c=0;c<viewModel.sideBarArray().length;c++)f==viewModel.sideBarArray()[c]&&(f="duplicate");"duplicate"!=f&&"notSearchedFor"!=f&&(viewModel.sideBarArray.push(f),a.push(h),viewModel.sideBarArray.sort())})}),document.getElementById("sideBar").style.display="block",viewModel.addMarkers(a),viewModel.searchTerm("")},addSideBarInfo:function(){console.log("viewModel.category ",viewModel.category);for(marker in mapMarkers[viewModel.category])this.sideBarArray.push(mapMarkers[viewModel.category][marker].name);this.sideBarArray.sort(),document.getElementById("sideBar").style.display="block"},resetMarkerColor:function(){for(var a=0;a<viewModel.markers.length;a++){var b=viewModel.markers[a],c=b.icon;c=c.replace("white","brown"),b.icon=c,b.setMap(b.map),b.setZIndex(0)}},clickSideBar:function(){viewModel.resetMarkerColor();for(var a=0;a<viewModel.markers.length;a++){var b=viewModel.markers[a];if(b.id==this){var c=b.icon;c=c.replace("brown","white"),b.icon=c,b.map.panTo(b.getPosition()),b.setMap(b.map),b.id=this.toString(),b.setZIndex(1),viewModel.mapPopUp(b);for(var d=document.getElementsByClassName("sideBarElems"),a=0;a<d.length;a++)d[a].setAttribute("id","null")}}},resetSideBar:function(){this.sideBarArray([])},clearSearch:function(){viewModel.clearMarkers(),viewModel.resetSideBar(),document.getElementById("searchForm").reset()},retrieveJsonArray:function(a){var b=[];return $.each(viewModel_onLoad.searchCategories,function(c,d){var e=d;$.each(mapMarkers[e],function(c,d){var f=mapMarkers[e][c][a];b.push(f)})}),b}};viewModel.initFacebook(),ko.applyBindings(viewModel);