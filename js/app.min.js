var mapMarkers={obstructions:[{name:"Submerged Tree",center:{lat:38.1025,lng:-121.5625},url:"http://www.vesselassistsanfrancisco.com/",img:"images/vesAssist.jpg",icon:"/images/mapIcons/pirates_brown.png"},{name:"Embedded Log",center:{lat:38.12,lng:-121.5855},url:"http://www.vesselassistsanfrancisco.com/",img:"images/vesAssist.jpg",icon:"/images/mapIcons/pirates_brown.png"}],anchorages:[{name:"The Meadows",center:{lat:38.2509717,lng:-121.497613},url:"http://www.parks.ca.gov/?page_id=492",img:"http://www.parks.ca.gov/pages/492/images/DeltaMeadowsProp_S0006502_npg.jpg",icon:"/images/mapIcons/harbor_brown.png"},{name:"Mandeville Tip",center:{lat:38.0618274,lng:-121.5345715},url:"http://dbw.parks.ca.gov/maps/facilityinfo.asp?facilityID=1217",img:"images/mandeville.jpg",icon:"/images/mapIcons/harbor_brown.png"},{name:"The Bedrooms",center:{lat:38.0841627,lng:-121.538574},url:"https://www.google.com/search?q=potato+slough+california+delta&biw=1013&bih=637&source=lnms&tbm=isch&sa=X&ved=0CAcQ_AUoAmoVChMIvvu29NmXyAIVypWICh2iOQmF",img:"images/genericDelta.jpg",icon:"/images/mapIcons/harbor_brown.png"}],restaurants:[{name:"Korth's Pirates' Lair",center:{lat:38.0977543,lng:-121.5680157},fb:"https://www.facebook.com/Korths-Pirates-Lair-Marina-348297131692/timeline/"},{name:"Lighthouse",center:{lat:38.1057531,lng:-121.5707022},fb:"https://www.facebook.com/Lighthouse-Marina-Restaurant-and-Resort-151574161575567/timeline/",icon:"/images/mapIcons/burger_brown.png"},{name:"Moore's Riverboat",center:{lat:38.1007412,lng:-121.5658718},url:"https://www.facebook.com/pages/Moores-Riverboat-Isleton/128136840571906?fref=ts",img:"images/moores.jpg",icon:"/images/mapIcons/burger_brown.png"},{name:"Rosa's",center:{lat:38.1101495,lng:-121.4983044},fb:"https://www.facebook.com/Rosasattowerpark",icon:"/images/mapIcons/burger_brown.png"},{name:"Giusti's Place",center:{lat:38.2242578,lng:-121.5071795},fb:"https://www.facebook.com/Giustis-341683185695/timeline/",icon:"/images/mapIcons/burger_brown.png"},{name:"Windmill Cove",center:{lat:37.9910241,lng:-121.4074522},fb:"https://www.facebook.com/Windmill-Cove-Bar-and-Grill-158184030912668/timeline/"},{name:"The Point",center:{lat:38.1487831,lng:-121.6909701},fb:"https://www.facebook.com/ThePointRestaurantRioVista",icon:"/images/mapIcons/burger_brown.png"},{name:"Boardwalk Grill",center:{lat:37.9056747,lng:-121.5869824},fb:"https://www.facebook.com/Boardwalk-Grill-285018528287/timeline/",icon:"/images/mapIcons/burger_brown.png"},{name:"Wimpy's",center:{lat:38.2264718,lng:-121.490745},fb:"https://www.facebook.com/Wimpys-Marina-405286399555382/timeline/",icon:"/images/mapIcons/burger_brown.png"},{name:"Orwood",center:{lat:37.9388633,lng:-121.6123867},fb:"https://www.facebook.com/orwoodresort"},{name:"Rusty Porthole",center:{lat:38.0347238,lng:-121.6230485},fb:"https://www.facebook.com/Rusty-Porthole-217097898307326/timeline/",icon:"/images/mapIcons/burger_brown.png"}],bars:[{name:"Windmill Cove",center:{lat:37.9910241,lng:-121.4074522},fb:"https://www.facebook.com/Windmill-Cove-Bar-and-Grill-158184030912668/timeline/",icon:"/images/mapIcons/bar_brown.png"},{name:"Lost Isle",center:{lat:37.9989336,lng:-121.4498872},url:"https://www.facebook.com/groups/327403865799/",img:"images/lostisle.jpg",icon:"/images/mapIcons/bar_brown.png"},{name:"Sugar Barge",center:{lat:38.0280595,lng:-121.6116769},url:"https://www.facebook.com/sugar.barge?fref=ts",img:"images/sugarbarge.jpg",icon:"/images/mapIcons/burger_brown.png"},{name:"Spindrift",center:{lat:38.1077053,lng:-121.5981793},url:"http://www.thespindrift.com/",img:"images/spindrift.jpg",icon:"/images/mapIcons/bar_brown.png"}],repairs:[{name:"Delta Boat Works",center:{lat:38.0997402,lng:-121.5669706},url:"http://deltaboatworks.com/",img:"images/boatWorks.jpg",icon:"/images/mapIcons/repair_brown.png"},{name:"Perry's",center:{lat:38.1255365,lng:-121.5820935},url:"http://www.perrysboatharbor.com/",img:"images/perrys.jpg"},{name:"Tower Park Marina",center:{lat:38.1101495,lng:-121.4983044},url:"https://www.facebook.com/pages/Tower-Park-Marina-And-Resort/150871971609324",img:"images/towerpark.jpg"}],gas:[{name:"Willow Berm",center:{lat:38.1038469,lng:-121.5677196},fb:"https://www.facebook.com/willowberm?fref=ts"},{name:"Paradise Point",center:{lat:38.0464052,lng:-121.4182412},fb:"https://www.facebook.com/ParadisePointMarina"},{name:"Tower Park Marina",center:{lat:38.1101495,lng:-121.4983044},url:"https://www.facebook.com/pages/Tower-Park-Marina-And-Resort/150871971609324",img:"images/towerpark.jpg"},{name:"Windmill Cove",center:{lat:37.9910241,lng:-121.4074522},fb:"https://www.facebook.com/Windmill-Cove-Bar-and-Grill-158184030912668/timeline/",icon:"/images/mapIcons/burger_brown.png"},{name:"B and W",center:{lat:38.1285623,lng:-121.5801002},fb:"https://www.facebook.com/B-W-Resort-Marina-118918581453710/timeline/"}],berthing:[{name:"Discovery Bay",center:{lat:37.9056747,lng:-121.5869824},fb:"https://www.facebook.com/Discovery-Bay-Yacht-Harbor-134771066597263/timeline/"},{name:"Whiskey Slough",center:{lat:37.9357669,lng:-121.4326344},fb:"https://www.facebook.com/Whiskey-Slough-Marina-Indoor-Boat-Storage-Bar-and-Grill-149733071729373/timeline/"},{name:"Tower Park Marina",center:{lat:38.1101495,lng:-121.4983044},url:"https://www.facebook.com/pages/Tower-Park-Marina-And-Resort/150871971609324",img:"images/towerpark.jpg"},{name:"Willow Berm",center:{lat:38.1038469,lng:-121.5677196},fb:"https://www.facebook.com/willowberm?fref=ts"},{name:"Paradise Point",center:{lat:38.0464052,lng:-121.4182412},fb:"https://www.facebook.com/ParadisePointMarina"},{name:"B and W",center:{lat:38.1285623,lng:-121.5801002},fb:"https://www.facebook.com/B-W-Resort-Marina-118918581453710/timeline/"},{name:"Perry's",center:{lat:38.1255365,lng:-121.5820935},url:"http://www.perrysboatharbor.com/",img:"images/perrys.jpg"},{name:"Spindrift",center:{lat:38.1077053,lng:-121.5981793},url:"http://www.spindriftmarina.com/",img:"images/spindrift.jpg",icon:"/images/mapIcons/bar_brown.png"},{name:"Owl Harbor",center:{lat:38.1162493,lng:-121.6257876},fb:"https://www.facebook.com/Owl-Harbor-Marina-117030248315538/timeline/"}],rentals:[{name:"Tower Park Marina",center:{lat:38.1101495,lng:-121.4983044},url:"https://www.facebook.com/pages/Tower-Park-Marina-And-Resort/150871971609324",img:"images/towerpark.jpg"},{name:"Lighthouse",center:{lat:38.1057531,lng:-121.5707022},fb:"https://www.facebook.com/Lighthouse-Marina-Restaurant-and-Resort-151574161575567/timeline/"},{name:"Paradise Point",center:{lat:38.0464052,lng:-121.4182412},fb:"https://www.facebook.com/ParadisePointMarina"}],lodging:[{name:"Stockton Delta KOA",center:{lat:38.1101495,lng:-121.4983044},fb:"https://www.facebook.com/StocktonKOA"},{name:"B and W",center:{lat:38.1285623,lng:-121.5801002},fb:"https://www.facebook.com/B-W-Resort-Marina-118918581453710/timeline/"},{name:"Whiskey Slough",center:{lat:37.9357669,lng:-121.4326344},fb:"https://www.facebook.com/Whiskey-Slough-Marina-Indoor-Boat-Storage-Bar-and-Grill-149733071729373/timeline/"}],launches:[{name:"Orwood",center:{lat:37.9388633,lng:-121.6123867},fb:"https://www.facebook.com/orwoodresort"},{name:"Whiskey Slough",center:{lat:37.9357669,lng:-121.4326344},fb:"https://www.facebook.com/Whiskey-Slough-Marina-Indoor-Boat-Storage-Bar-and-Grill-149733071729373/timeline/"},{name:"Paradise Point",center:{lat:38.0464052,lng:-121.4182412},fb:"https://www.facebook.com/ParadisePointMarina"},{name:"B and W",center:{lat:38.1285623,lng:-121.5801002},fb:"https://www.facebook.com/B-W-Resort-Marina-118918581453710/timeline/"},{name:"Discovery Bay",center:{lat:37.9056747,lng:-121.5869824},fb:"https://www.facebook.com/Discovery-Bay-Yacht-Harbor-134771066597263/timeline/"}],stores:[{name:"B and W",center:{lat:38.1285623,lng:-121.5801002},fb:"https://www.facebook.com/B-W-Resort-Marina-118918581453710/timeline/"},{name:"Paradise Point",center:{lat:38.0464052,lng:-121.4182412},fb:"https://www.facebook.com/ParadisePointMarina"},{name:"Tower Park Marina",center:{lat:38.1101495,lng:-121.4983044},url:"https://www.facebook.com/pages/Tower-Park-Marina-And-Resort/150871971609324",img:"images/towerpark.jpg"}]},noaaData={urls:[windURL="http://tidesandcurrents.noaa.gov/api/datagetter?date=latest&station=9415144&product=wind&units=english&time_zone=gmt&application=weather&format=json",waterURL="http://tidesandcurrents.noaa.gov/api/datagetter?date=latest&station=9415144&product=water_temperature&units=english&time_zone=gmt&application=weather&format=json",airURL="http://tidesandcurrents.noaa.gov/api/datagetter?date=latest&station=9415144&product=air_temperature&units=english&time_zone=gmt&application=weather&format=json"],labels:["Wind Speed: ","Water Temp: ","Air Temp: "],attrs:["s","v","v"],suffixes:["knots","degrees","degrees"]},viewModel={searchCategories:Object.keys(mapMarkers),init:function(){for(var a=document.getElementById("buttonBar"),b=0;b<viewModel.searchCategories.length;b++){var c=document.createElement("BUTTON");c.innerHTML=viewModel.searchCategories[b],c.setAttribute("data-bind","click: categoryClick"),c.setAttribute("class","catButton"),a.appendChild(c)}viewModel.noaaRequest(),viewModel.initFacebook()},compareLocations:function(a,b){var c=38.103,d=-121.572,e=.1,f=!1;if(e>a-c){var g=a-c;if(e>a+c){var g=e>a+c;g>0&&e>g&&(f=!0)}}var h=!1;if(e>b-d){var g=b-d;if(e>b+d){var i=e>b+d;i>0&&e>i&&(h=!0)}}return f&&1==h?!0:void 0},userLocation:function(a){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){var c={lat:b.coords.latitude,lng:b.coords.longitude};1==viewModel.compareLocations(b.coords.latitude,b.coords.longitude)&&a.setCenter(c)}):console.log("continuing on to delta loop map")},initMap:function(){var a=setTimeout(function(){$(".errorText").text("google maps failed to load")},8e3),b=document.getElementById("map"),c={center:{lat:38.103,lng:-121.572},zoom:12,mapTypeId:google.maps.MapTypeId.HYBRID},d=new google.maps.Map(b,c);viewModel.userLocation(d);for(var e=0;e<mapMarkers.obstructions.length;e++)new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:d,center:mapMarkers.obstructions[e].center,radius:30,draggable:!0});var f=new google.maps.InfoWindow({map:d});this.infowindow=f,f.close(),this.map=d,clearTimeout(a)},initFacebook:function(){window.fbAsyncInit=function(){FB.init({appId:"887545611339686",xfbml:!0,version:"v2.4"})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")},markers:[],addMarkers:function(a){var b=a.length,c=new google.maps.LatLngBounds;for(i=0;i<b;i++){var d=a[i].center.lat,e=a[i].center.lng,f=a[i].center;if(a[i].icon)var g=a[i].icon;else var g="/images/mapIcons/marina_brown.png";viewModel.markers.push(new google.maps.Marker({position:f,map:this.map,animation:google.maps.Animation.DROP,id:a[i].name,icon:g})),viewModel.markers[i].addListener("click",viewModel.clickMarker),c.extend(new google.maps.LatLng(d,e))}this.map.fitBounds(c),this.map.panBy(-60,0)},mapPopUp:function(a){this.infowindow.close();for(var b=viewModel.retrieveJsonArray("fb"),c=viewModel.retrieveJsonArray("url"),d=viewModel.retrieveJsonArray("name"),e=viewModel.retrieveJsonArray("img"),f=0;f<d.length;f++)if(a.id==d[f]){var g=b[f],h=c[f],i=e[f];if(void 0!=g)var j='<div id="fb-root"></div><div class="fb-page" data-href="'+g+'" data-small-header="true" data-adapt-container-width="false" data-hide-cover="false" data-show-facepile="false" data-show-posts="false"><div class="fb-xfbml-parse-ignore"><blockquote cite="'+g+'"><a href="'+g+'" target="_blank">click me</a></blockquote></div></div>';else var j='<div><a href= "'+h+'" target="_blank"><h3>'+a.id+'</h3><img class="infoWindowImg" src="'+i+'" alt="scenic image"></div><div></a></div>';this.infowindow.setContent(j),this.infowindow.open(a.map,a)}FB.XFBML.parse()},clickMarker:function(){var a=document.getElementsByClassName("sideBarElems"),b=this;viewModel.resetMarkerColor();for(var c=0;c<viewModel.markers.length;c++){var d=a[c].id;if("highlight"==d)a[c].setAttribute("id","null");else if(a[c].innerHTML==this.id){viewModel.mapPopUp(b),a[c].setAttribute("id","highlight");var e=this.icon;e=e.replace("brown","white"),this.icon=e,this.map.panTo(this.getPosition()),this.setMap(this.map),this.setZIndex(1)}}},clearMarkers:function(){for(var a=0;a<viewModel.markers.length;a++)viewModel.markers[a].setMap(null);viewModel.markers=[]},categoryClick:function(){this.category=event.target.innerHTML,viewModel.resetSideBar(),viewModel.clearMarkers(),viewModel.addSideBarInfo(),viewModel.addMarkers(mapMarkers[this.category])},sideBarArray:ko.observableArray(),searchTerm:ko.observable(),ph:ko.observable("search all locations"),searchButton:function(){viewModel.clearSearch();var a=[],b=new RegExp(viewModel.searchTerm(),"i");$.each(viewModel.searchCategories,function(c,d){var e=d;$.each(mapMarkers[e],function(c,d){var f=mapMarkers[e][c].name,g=f.toString(),h=mapMarkers[e][c],i=b.test(g);0==i&&(f="notSearchedFor");for(var c=0;c<viewModel.sideBarArray().length;c++)f==viewModel.sideBarArray()[c]&&(f="duplicate");"duplicate"!=f&&"notSearchedFor"!=f&&(viewModel.sideBarArray.push(f),a.push(h),viewModel.sideBarArray.sort())})}),viewModel.addMarkers(a),viewModel.searchTerm("")},toggleSideBar:ko.observable(!1),lowerButton:ko.observable(!0),upperButton:ko.observable(!1),hideSideBarFunc:function(){viewModel.toggleSideBar(!1),viewModel.upperButton(!0)},showSideBarFunc:function(){viewModel.toggleSideBar(!0),viewModel.upperButton(!1)},addSideBarInfo:function(){for(marker in mapMarkers[this.category])this.sideBarArray.push(mapMarkers[this.category][marker].name);this.sideBarArray.sort(),viewModel.showSideBarFunc()},resetMarkerColor:function(){for(var a=0;a<viewModel.markers.length;a++){var b=viewModel.markers[a],c=b.icon;c=c.replace("white","brown"),b.icon=c,b.setMap(b.map),b.setZIndex(0)}},clickSideBar:function(){viewModel.resetMarkerColor();for(var a=0;a<viewModel.markers.length;a++){var b=viewModel.markers[a];if(b.id==this){var c=b.icon;c=c.replace("brown","white"),b.icon=c,b.map.panTo(b.getPosition()),b.setMap(b.map),b.id=this.toString(),b.setZIndex(1),viewModel.mapPopUp(b);for(var d=document.getElementsByClassName("sideBarElems"),a=0;a<d.length;a++)d[a].setAttribute("id","null")}}},resetSideBar:function(){this.sideBarArray([])},clearSearch:function(){viewModel.clearMarkers(),viewModel.resetSideBar(),document.getElementById("searchForm").reset()},retrieveJsonArray:function(a){var b=[];return $.each(viewModel.searchCategories,function(c,d){var e=d;$.each(mapMarkers[e],function(c,d){var f=mapMarkers[e][c][a];b.push(f)})}),b},statWind:ko.observable("Wind Speed: not available"),statWater:ko.observable("Water Temperature: not available"),statAir:ko.observable("Air Temperature: not available"),noaaRequest:function(a){var b=[viewModel.statWind,viewModel.statWater,viewModel.statAir];document.getElementsByClassName;$.each(noaaData.urls,function(a){var c="https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent("select * from json where url=@url")+"&url="+encodeURIComponent(noaaData.urls[a])+"&format=json&callback=?";$.getJSON(c,function(c){var d=noaaData.labels[a],e=noaaData.suffixes[a],f=noaaData.attrs[a],g=c.query.results.json.data[f],h=b[a];h(d+" "+g+" "+e)})})}};viewModel.init(),ko.applyBindings(viewModel);